---
title: "Explore Providers"
description: |
  Some additional details about the blog
output: 
  distill::distill_article:
    toc: true
    css: dashboard_header.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Texas Summary

```{r echo=FALSE}

library(gt)
library(tidyverse)
library(readxl)
library(janitor)

today <- Sys.Date()
src <- "https://dshs.texas.gov/immunize/covid19/COVID-19-Vaccine-Data-by-County.xls" # URL For Daily COVID Data
lcl <- basename(src)
filepath <- paste0(today,"_",lcl,"x")
download.file(url = src, destfile = filepath) # Downloads The Data

read_excel(filepath, sheet = "By County", skip=0) %>% 
  clean_names() %>% 
  filter(county_name=="Texas") %>% 
  select(county_name, population_16, people_fully_vaccinated, total_doses_allocated, starts_with("population_phase_")) %>% 
  pivot_longer(cols=starts_with("population_phase_"), names_to = "phase_pop_est", values_to = "value") %>%
  ggplot() +
  geom_col(data = . %>%  slice(1), aes(y=county_name, x=population_16), alpha = .3) +
  geom_col(aes(y=county_name, x=value, fill = phase_pop_est), alpha=.9) +
  geom_vline(aes(xintercept=total_doses_allocated), linetype = 2, color = "red") +
  geom_vline(aes(xintercept=people_fully_vaccinated), linetype = 2, color = "blue") +
  scale_x_continuous(labels = scales::unit_format(unit = "M", scale = 1e-6)) +
  theme_minimal(base_family = "Graphik") +
  annotate(
    geom = "curve", color = "red", x = 2858050, y = 1.55, xend = 2258050, yend = 1.5,
    curvature = .1, arrow = arrow(length = unit(2, "mm"))
  ) +
  annotate(geom = "label", x = 2958050, y = 1.53, color = "red", label = "Vaccines Shipped (~2mil)", family = "Graphik", hjust = "left") +
  annotate(
    geom = "curve", color = "blue", x = 852396, y = .48, xend = 352396, yend = .54 , 
    curvature = -.1, arrow = arrow(length = unit(2, "mm"))
  ) +
  annotate(geom = "label", x = 952396, y = .5, color = "blue", label = "Fully Vacinated (~132k)", family = "Graphik", hjust = "left") +
  ggthemes::scale_fill_economist() +
  theme(plot.title = element_text(family = "Graphik-Bold"),
        legend.position = "top") +
  labs(title = "Texas Summary of Progress Towards Vaccinations",
       subtitle = "Source: Texas Department of State Health Services",
       x = "Texas Population Aged 16 + Above",
       y = NULL,
       fill = "Eligible Phases",
       caption = "Data File: 'Accessible Vaccine Dashboard Data'\nLink: https://dshs.texas.gov/immunize/covid19/COVID-19-Vaccine-Data-by-County.xls") #+
  # ggsave("tx_vaccine_summary.png", dpi = 300, width = 12, height = 5)

```

<details class = "l-body">
<summary><strong>Info | </strong>Who is currently eligible in Texas?</summary>

## Phase 1A {.unlisted .unnumbered}

### First Tier

* Paid and unpaid workers in hospital settings working directly with patients wh* are positive or at high risk for COVID-19. Such as but not limited to:
* Physicians, nurses, respiratory therapists and other support staff (custodial staff, etc.)
* Additional clinical staff providing supporting laboratory, pharmacy, diagnostic and/or rehabilitation services
* Others having direct contact with patients or infectious materials
* Long-term care staff working directly with vulnerable residents. Includes:
* Direct care providers at nursing homes, assisted living facilities, and state supported living centers
* Physicians, nurses, personal care assistants, custodial, food service staff
* EMS providers wh* engage in 9-1-1 emergency services like pre-hospital care and
transport
* Home health care workers, including hospice care, wh* directly interface with
vulnerable and high-risk patients
* Residents of long-term care facilities

### Second Tier

* Staff in outpatient care settings wh* interact with symptomatic patients. Such as but not limited to:
* Physicians, nurses, and other support staff (custodial staff, etc.)
* Clinical staff providing diagnostic, laboratory, and/or rehabilitation services * Non 9-1-1 transport for routine care
* Healthcare workers in corrections and detention facilities
* Direct care staff in freestanding emergency medical care facilities and urgent care clinics
* Community pharmacy staff wh* may provide direct services t* clients, including
vaccination or testing for individuals wh* may have COVID
* Public health and emergency response staff directly involved in administration of COVID
testing and vaccinations
* Last responders wh* provide mortuary or death services t* decedents with COVID-19.
Includes:
* Embalmers and funeral home workers wh* have direct contact with decedents * Medical examiners and other medical certifiers wh* have direct contact with
decedents
* School nurses wh* provide health care t* students and teachers

## Phase 1B {.unlisted .unnumbered}

* People 65 years of age and older
* People 16 years of age and older with at least one chronic medical condition that puts
them at increased risk for severe illness from the virus that causes COVID-19, such as but not limited to:
* Cancer
* Chronic kidney disease
* COPD (chronic obstructive pulmonary disease)
* Heart conditions, such as heart failure, coronary artery disease or cardiomyopathies
* Solid organ transplantation
* Obesity and severe obesity (body mass index of 30 kg/m2 or higher)
* Pregnancy
* Sickle cell disease
* Type 2 diabetes mellitus

```{r}

library(gt)
library(tidyverse)
library(readxl)
library(janitor)

today <- Sys.Date()
src <- "https://dshs.texas.gov/immunize/covid19/COVID-19-Vaccine-Data-by-County.xls" # URL For Daily COVID Data
lcl <- basename(src)
filepath <- paste0(today,"_",lcl,"x")
download.file(url = src, destfile = filepath) # Downloads The Data

read_excel(filepath, sheet = "By County", skip=0) %>% 
  clean_names() %>% 
  select(county_name, total_doses_allocated, vaccine_doses_administered) %>% 
  filter(county_name=="Texas") %>% 
  pivot_longer(cols=c(total_doses_allocated, vaccine_doses_administered), names_to = "type", values_to = "value") %>% 
  gt() %>% 
  tab_header(title = md("**Phase 1B Eligibility**"),
             subtitle = "Source: Texas Department of State Health Services | As of January 10th at 3:00PM CST") %>%
  tab_source_note(
    source_note = "*Unable to deduplicate figures for Commercial labs."
  ) %>% 
  tab_footnote(footnote = md("[Data: From the 'Accessible Dashboard Data' File, under the 'Tests' tab.](https://www.dshs.state.tx.us/coronavirus/additionaldata/)"), locations = cells_title("subtitle")) %>% 
    fmt_number(columns="value", suffixing=TRUE) %>% 
  cols_label(county_name=md("**Location**"),
             type=md("**Type**"),
             value=md("**Value**")) %>% 
#   summary_rows(
#     columns = vars(count),
#     fns = list(
#       `Total Tests` = ~sum(.)),
#     formatter = fmt_number,
#     decimals=0,
#     use_seps = TRUE
# ) %>% 
  tab_options(
    grand_summary_row.background.color = "#f5f5f5",
    heading.title.font.weight = "800",
  )
```

</details>

## County Summaries 

```{r echo=FALSE, message=FALSE, warning=FALSE, layout = "l-page"}
knitr::include_app("https://mrworthington.shinyapps.io/tx_vaccine-explorer/", height = "1800px")
```

## Photography Credit {.appendix}

<span>Photo by <a href="https://unsplash.com/@schluditsch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Daniel Schludi</a> on <a href="https://unsplash.com/s/photos/vaccine-covid?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>